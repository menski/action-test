name: Add comment with stage URL to pull request
on: pull_request

jobs:
  add-comment:
    name: Add comment to issue
    runs-on: ubuntu-latest
    steps:
      - name: comment PR
        uses: actions/github-script@0.5.0
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            const prefix = context.payload.pull_request.head.ref.split('-', 2).join('-')
            const jira = `https://app.camunda.com/jira/browse/${prefix.toUpperCase()}`
            const stage = `https://${prefix.toLowerCase()}.operate.camunda.cloud`

            github.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `JIRA: ${jira}\nStage: ${stage}`
            })
